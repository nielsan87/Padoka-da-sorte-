package main

import (
	"fmt"
	"html/template"
	"math/rand"
	"net/http"
	"time"
)

var symbols = []string{"ğŸ", "ğŸ¥–", "ğŸ°", "ğŸ§", "ğŸ¥"}

type SlotResult struct {
	Reel1   string
	Reel2   string
	Reel3   string
	Message string
}

var tpl = template.Must(template.New("slot").Parse(`
<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Padoka da Sorte ğŸ°</title>
<style>
  body { font-family: Arial, sans-serif; text-align: center; padding: 50px; background: #fff8e1; }
  h1 { color: #d2691e; }
  .reels { font-size: 80px; margin: 20px 0; }
  button { font-size: 24px; padding: 10px 20px; background: #f4a261; border: none; border-radius: 10px; cursor: pointer; }
  button:hover { background: #e76f51; color: white; }
  .message { font-size: 28px; margin-top: 30px; color: #2a9d8f; }
</style>
</head>
<body>
  <h1>Padoka da Sorte ğŸ°</h1>
  <form method="POST" action="/">
    <div class="reels">{{.Reel1}} | {{.Reel2}} | {{.Reel3}}</div>
    <button type="submit">Girar!</button>
  </form>
  {{if .Message}}
  <div class="message">{{.Message}}</div>
  {{end}}
</body>
</html>
`))

func spin() (string, string, string) {
	rand.Seed(time.Now().UnixNano())
	return symbols[rand.Intn(len(symbols))],
		symbols[rand.Intn(len(symbols))],
		symbols[rand.Intn(len(symbols))]
}

func checkWin(r1, r2, r3 string) bool {
	return r1 == r2 && r2 == r3
}

func handler(w http.ResponseWriter, r *http.Request) {
	data := SlotResult{
		Reel1:   "â“",
		Reel2:   "â“",
		Reel3:   "â“",
		Message: "",
	}

	if r.Method == http.MethodPost {
		r1, r2, r3 := spin()
		data.Reel1, data.Reel2, data.Reel3 = r1, r2, r3

		if checkWin(r1, r2, r3) {
			data.Message = "ğŸ‰ ParabÃ©ns! VocÃª ganhou na Padoka da Sorte! ğŸ‰"
		} else {
			data.Message = "Tente de novo! ğŸğŸ¥–ğŸ°ğŸ§ğŸ¥"
		}
	}

	tpl.Execute(w, data)
}

func main() {
	http.HandleFunc("/", handler)
	fmt.Println("Servidor rodando em http://localhost:8080")
	http.ListenAndServe(":8080", nil)
}
